{% import "bootstrap/wtf.html" as wtf %}
{% extends "base.html" %}

{% block head %}
  <style>
    #here {
      position: relative;
      padding-top: 75px;
    }
  </style>
{% endblock %}

{% block form %}
<ul class="nav nav-tabs">
  {% if parallelOrNot == 1 %}
    <li class="nav-item">
      <a class="nav-link active" href="{{ url_for('functions.browse', parallelOrNot=1) }}">single</a>
    </li>
    <li class="nav-item">
      <a class="nav-link" href="{{ url_for('functions.browse', parallelOrNot=2) }}">parallel</a>
    </li>
  {% elif parallelOrNot == 2 %}
    <li class="nav-item">
      <a class="nav-link" href="{{ url_for('functions.browse', parallelOrNot=1) }}">single</a>
    </li>
    <li class="nav-item">
      <a class="nav-link active" href="{{ url_for('functions.browse', parallelOrNot=2) }}">parallel</a>
    </li>
  {% endif %}
</ul>

  <form method="POST">
    {{form.csrf_token}}
    {% if parallelOrNot == 1 %}
    <p>Select a translation</p>
    <div class="form-group">
      <div class="form-row">
        <div class="col">
          {{ wtf.form_field(form.language1, class="form-control form-control-sm") }}
        </div>
        <div class="col">
          {{ wtf.form_field(form.translation1, class="form-control form-control-sm") }}
        </div>
      </div>
    </div>
    {% elif parallelOrNot == 2 %}
      <p>Primary translation</p>
      <div class="form-group">
        <div class="form-row">
          <div class="col">
            {{ wtf.form_field(form.language1, class="form-control form-control-sm") }}
          </div>
          <div class="col">
            {{ wtf.form_field(form.translation1, class="form-control form-control-sm")}}
          </div>
        </div>
      </div>
      <hr>
    <p>Secondary translation</p>
      <div class="form-group">
        <div class="form-row">
          <div class="col">
            {{ wtf.form_field(form.language2, class="form-control form-control-sm") }}
          </div>
          <div class="col">
            {{ wtf.form_field(form.translation2, class="form-control form-control-sm")}}
          </div>
        </div>
      </div>
    {% endif %}
      <hr>
      <div class="form-group">
        {{ wtf.form_field(form.book, class="form-control form-control-sm") }}
      </div>
      <hr>
    <div class="form-group">
      {{ wtf.form_field(form.submit, class="form-control form-control-sm") }}
    </div>
  </form>

  <script>
        var lang_select = document.getElementById("language1");
        var tran_select = document.getElementById("translation1");

        lang_select.onchange = function()  {

            language1 = lang_select.value;

            fetch('/translation1/' + language1).then(function(response) {

                response.json().then(function(data) {
                    var optionHTML = '';

                    for (var translation of data.translations) {
                        optionHTML += '<option value="' + translation.id + '">' + translation.translation + '</option>';
                    }

                    tran_select.innerHTML = optionHTML;
                })

            });
        }
    </script>

    {% if parallelOrNot == 2 %}
      <script>
            var lang_select2 = document.getElementById("language2");
            var tran_select2 = document.getElementById("translation2");

            lang_select2.onchange = function()  {

                language2 = lang_select2.value;

                fetch('/translation1/' + language2).then(function(response) {

                    response.json().then(function(data) {
                        var optionHTML = '';

                        for (var translation of data.translations) {
                            optionHTML += '<option value="' + translation.id + '">' + translation.translation + '</option>';
                        }

                        tran_select2.innerHTML = optionHTML;
                    })

                });
            }
      </script>
    {% endif %}

    <script>
          var tran_select = document.getElementById("translation1");
          var book_select = document.getElementById("book");

          tran_select.onchange = function()  {

              translation1 = tran_select.value;

              fetch('/book/' + translation1).then(function(response) {

                  response.json().then(function(data) {
                      var optionHTML = '';

                      for (var book of data.books) {
                          optionHTML += '<option value="' + book.id + '">' + book.book + '</option>';
                      }

                      book_select.innerHTML = optionHTML;
                  })

              });
          }
      </script>

{% endblock %}

{% block content %}

<div class="container">
  {% if textLength == 0 %}
  <h1>The book you are looking for is not included in this translation</h1>
  {% else %}
  {% for verse in texts %}
  <div class="row">
    {% if parallelOrNot == 1 %}
      <div class="col-2">
        {% if verse.title + " " + verse.chapter + ":" + verse.verse|string == verseCode %}
          <p><span id='here'>{{ verse.title + " " + verse.chapter + ":" + verse.verse|string }}</span></p>
        {% else %}
          <p>{{ verse.title + " " + verse.chapter + ":" + verse.verse|string }}</p>
        {% endif %}
      </div>
      <div class="col">
        <p>{{verse.text}}</p>
      </div>
    {% elif parallelOrNot == 2 %}
      <div class="col-2">
        <p>{{verse[1] + " " + verse[2] + ":" + verse[3]|string}}</p>
      </div>
      <div class="col">
        <p>{{verse[4]}}</p>
      </div>
      <div class="col">
        <p>{{verse[5]}}</p>
      </div>
    {% endif %}
  </div>
  {% endfor %}
  {% endif %}
</div>
{% endblock %}
